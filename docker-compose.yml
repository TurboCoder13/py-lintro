---
services:
  lintro:
    build:
      context: .
      dockerfile: Dockerfile
    logging:
      driver: local
      options:
        max-size: '10m'
        max-file: '3'
    volumes:
      - ${PWD:-./}:/app
      # The command will be overridden when running docker compose
      # Example: docker compose run --rm lintro check --format grid
      #          --tools ruff,darglint .
  test-integration:
    build: .
    image: py-lintro-test:latest
    logging:
      driver: local
      options:
        max-size: '10m'
        max-file: '3'
    working_dir: /app
    volumes:
      - ${PWD:-./}:/app
      # Mount current directory to /app so tests run against current source
    command:
      - /app/scripts/local/run-tests.sh
    entrypoint:
      - ''
    environment:
      - PYTHONUNBUFFERED=1
      - PYTHONDONTWRITEBYTECODE=1
      - RUNNING_IN_DOCKER=1
      - LINTRO_RUN_DOCKER_TESTS=1
      - DOCKER_BUILDKIT=0
      - COVERAGE_OUTPUT_DIR=/app
    user: root
    # Run as root to avoid permission issues with mounted volumes
